<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyleCode Analytics Enterprise Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; font-size: 13px; color: #1e293b; }
        
        .table-container { height: 320px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 12px; background: white; box-shadow: inset 0 2px 4px rgba(0,0,0,0.02); }
        table { width: 100%; border-collapse: separate; border-spacing: 0; }
        th { position: sticky; top: 0; background: #f8fafc; z-index: 20; border-bottom: 1px solid #e2e8f0; padding: 12px 10px; font-size: 0.75rem; color: #64748b; font-weight: 700; text-align: left; }
        td { padding: 10px; border-bottom: 1px solid #f1f5f9; font-size: 0.8rem; }
        
        .section-title { font-size: 0.95rem; font-weight: 800; margin-bottom: 0.75rem; color: #0f172a; display: flex; justify-content: space-between; align-items: center; }
        
        .selected-online { background-color: #eff6ff !important; font-weight: 700; color: #1d4ed8; border-left: 4px solid #3b82f6; }
        .selected-offline { background-color: #fef2f2 !important; font-weight: 700; color: #b91c1c; border-left: 4px solid #ef4444; }
        .selected-customer { background-color: #f5f3ff !important; font-weight: 700; color: #7c3aed; border-left: 4px solid #8b5cf6; }
        .selected-total { background-color: #f1f5f9 !important; font-weight: 700; color: #0f172a; border-left: 4px solid #475569; }
        .clickable-row { cursor: pointer; transition: background 0.2s; }
        .clickable-row:hover { background-color: #f8fafc; }
        
        .btn-toggle { padding: 5px 12px; font-size: 0.7rem; font-weight: 700; border-radius: 6px; transition: all 0.2s; }
        .btn-active { background-color: white; color: #1e293b; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        .btn-inactive { color: #94a3b8; border: 1px solid transparent; }
        .control-group { background-color: #e2e8f0; padding: 3px; border-radius: 8px; display: flex; gap: 2px; }
        
        .group-header { border-bottom: 4px solid #0f172a; padding-bottom: 0.75rem; margin: 3rem 0 1.5rem 0; }
        .badge { font-size: 10px; padding: 2px 8px; border-radius: 9999px; font-weight: 800; }

        .select2-container { width: 100% !important; }
        .select2-selection--multiple { border: 1px solid #e2e8f0 !important; border-radius: 8px !important; padding: 2px 6px !important; background-color: #f8fafc !important; }
    </style>
</head>
<body class="p-8">
    <div class="max-w-[1600px] mx-auto">
        
        <header class="mb-8">
            <div>
                <h1 class="text-3xl font-black tracking-tighter text-slate-900">StyleCode Data Lab <span class="text-blue-600">v2.9</span></h1>
                <p class="text-slate-500 font-medium">실시간 판매 성과 및 고객 분석 통합 대시보드</p>
            </div>
        </header>

        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-10">
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-6">
                <div class="md:col-span-2">
                    <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest">Brand Selection</label>
                    <select id="brand" class="w-full border-slate-200 rounded-lg px-4 py-2.5 bg-slate-50 font-bold focus:ring-2 focus:ring-blue-500 outline-none">
                        <option>NIKE PERFORMANCE</option><option>ADIDAS ORIGINALS</option><option>NEW BALANCE</option>
                    </select>
                </div>
                <div class="md:col-span-3">
                    <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest">Category</label>
                    <select id="category" class="js-example-basic-multiple" multiple="multiple">
                        <option value="shoes" selected>FOOTWEAR</option><option value="top">TOPS</option><option value="bottom">PANTS</option><option value="acc">ACCESSORIES</option>
                    </select>
                </div>
                <div class="md:col-span-4">
                    <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest">Style Code</label>
                    <select id="styleCode" class="js-example-basic-multiple" multiple="multiple">
                        <option value="SC-001" selected>SC-AIR-01</option><option value="SC-002">SC-RUN-05</option><option value="SC-003">SC-CT-09</option>
                        <option value="SC-004">SC-LIFESTYLE-X</option><option value="SC-005">SC-PRO-CHAMP</option>
                    </select>
                </div>
                <div class="md:col-span-3">
                    <label class="block text-[10px] font-black text-slate-400 mb-2 uppercase tracking-widest">Analysis Period</label>
                    <div class="flex items-center gap-2 bg-slate-50 border border-slate-200 rounded-lg px-4 py-2">
                        <input type="date" id="startDate" class="bg-transparent font-bold text-xs outline-none cursor-pointer">
                        <span class="text-slate-300 font-bold">~</span>
                        <input type="date" id="endDate" class="bg-transparent font-bold text-xs outline-none cursor-pointer">
                    </div>
                </div>
            </div>
            <div class="flex justify-end">
                <button onclick="fetchAll()" class="bg-slate-900 text-white px-10 py-3 rounded-xl font-bold hover:bg-slate-800 transition transform active:scale-95 shadow-xl">조회하기</button>
            </div>
        </div>

        <div id="group-1">
            <div class="group-header flex justify-between items-center">
                <h2 class="text-2xl font-black text-slate-900 tracking-tight">1. ON/OFF PERFORMANCE</h2>
                <span class="text-slate-400 font-bold text-sm">CHANNEL & PRODUCT ANALYSIS</span>
            </div>

            <div class="mb-16">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-slate-600 rounded-full"></div>
                    <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight">TOTAL Performance Detailed</h3>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-slate-300" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>전체 실적</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);">
                                <table>
                                    <thead><tr><th>채널 구분</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead>
                                    <tbody id="total-list">
                                        <tr id="total-total-row" class="clickable-row selected-total" onclick="updateTotalDetail('전체', this)">
                                            <td class="font-bold">전체</td><td>772,100,000</td><td>6,300</td><td>100%</td>
                                        </tr>
                                        <tr class="clickable-row" onclick="updateTotalDetail('온라인', this)">
                                            <td class="pl-5 font-semibold text-blue-600">온라인</td><td>452,100,000</td><td>3,500</td><td>58.5%</td>
                                        </tr>
                                        <tr class="clickable-row" onclick="updateTotalDetail('오프라인', this)">
                                            <td class="pl-5 font-semibold text-red-600">오프라인</td><td>320,000,000</td><td>2,800</td><td>41.5%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>컬러별 판매 현황</span><span id="total-t-color" class="badge bg-slate-100 text-slate-600">전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table><thead><tr><th>컬러</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="total-color-body"></tbody></table></div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>사이즈별 판매 현황</span><span id="total-t-size" class="badge bg-slate-100 text-slate-600">전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table><thead><tr><th>사이즈</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="total-size-body"></tbody></table></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <span id="main-chart-title" class="text-sm font-black text-slate-600">TOTAL TREND ANALYSIS</span>
                        <div class="flex gap-2">
                            <div class="control-group">
                                <button id="main-sales" onclick="setChart('main', 'metric', 'sales')" class="btn-toggle btn-active">매출</button>
                                <button id="main-qty" onclick="setChart('main', 'metric', 'qty')" class="btn-toggle btn-inactive">수량</button>
                            </div>
                            <div class="control-group">
                                <button id="main-daily" onclick="setChart('main', 'view', 'daily')" class="btn-toggle btn-active">일</button>
                                <button id="main-weekly" onclick="setChart('main', 'view', 'weekly')" class="btn-toggle btn-inactive">주</button>
                                <button id="main-monthly" onclick="setChart('main', 'view', 'monthly')" class="btn-toggle btn-inactive">월</button>
                            </div>
                        </div>
                    </div>
                    <div style="height: 250px;"><canvas id="mainChart"></canvas></div>
                </div>
            </div>

            <div class="mb-16">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-blue-600 rounded-full"></div>
                    <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight">Online Performance Detailed</h3>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-slate-300" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>온라인 채널별 실적</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);">
                                <table>
                                    <thead><tr><th>채널명</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead>
                                    <tbody id="on-list">
                                        <tr id="on-total-row" class="clickable-row selected-online" onclick="updateIndicator('on', '온라인 전체', this)"><td>온라인 전체</td><td>452,100,000</td><td>3,500</td><td>100%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('on', '자사몰', this)"><td class="pl-6 text-slate-500">└ 자사몰</td><td>135,630,000</td><td>1,050</td><td>30%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('on', '무신사', this)"><td class="pl-6 text-slate-500">└ 무신사</td><td>113,025,000</td><td>875</td><td>25%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('on', '네이버 스토어', this)"><td class="pl-6 text-slate-500">└ 네이버 스토어</td><td>90,420,000</td><td>700</td><td>20%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('on', '29CM', this)"><td class="pl-6 text-slate-500">└ 29CM</td><td>67,815,000</td><td>525</td><td>15%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('on', 'W컨셉', this)"><td class="pl-6 text-slate-500">└ W컨셉</td><td>45,210,000</td><td>350</td><td>10%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>컬러별 판매 현황</span><span id="on-t-color" class="badge bg-blue-100 text-blue-600">온라인 전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table id="on-color-table"><thead><tr><th>컬러</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="on-color-body"></tbody></table></div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>사이즈별 판매 현황</span><span id="on-t-size" class="badge bg-blue-100 text-blue-600">온라인 전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table id="on-size-table"><thead><tr><th>사이즈</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="on-size-body"></tbody></table></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                    <div class="flex justify-between items-center mb-6">
                        <span id="on-chart-title" class="text-sm font-black text-blue-600">ONLINE TREND ANALYSIS</span>
                        <div class="flex gap-2">
                            <div class="control-group">
                                <button id="on-sales" onclick="setChart('on', 'metric', 'sales')" class="btn-toggle btn-active">매출</button>
                                <button id="on-qty" onclick="setChart('on', 'metric', 'qty')" class="btn-toggle btn-inactive">수량</button>
                            </div>
                            <div class="control-group">
                                <button id="on-daily" onclick="setChart('on', 'view', 'daily')" class="btn-toggle btn-active">일</button>
                                <button id="on-weekly" onclick="setChart('on', 'view', 'weekly')" class="btn-toggle btn-inactive">주</button>
                                <button id="on-monthly" onclick="setChart('on', 'view', 'monthly')" class="btn-toggle btn-inactive">월</button>
                            </div>
                        </div>
                    </div>
                    <div style="height: 250px;"><canvas id="onChart"></canvas></div>
                </div>
            </div>

            <div class="mb-16">
                <div class="flex items-center gap-3 mb-6">
                    <div class="w-2 h-8 bg-red-600 rounded-full"></div>
                    <h3 class="text-xl font-black text-slate-800 uppercase tracking-tight">Offline Performance Detailed</h3>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-slate-300" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>오프라인 채널별 실적</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);">
                                <table>
                                    <thead><tr><th>채널명</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead>
                                    <tbody id="off-list">
                                        <tr id="off-total-row" class="clickable-row selected-offline" onclick="updateIndicator('off', '오프라인 전체', this)"><td>오프라인 전체</td><td>320,000,000</td><td>2,800</td><td>100%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('off', '백화점', this)"><td class="pl-6 text-slate-500">└ 백화점</td><td>224,000,000</td><td>1,960</td><td>70%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('off', '대리점', this)"><td class="pl-6 text-slate-500">└ 대리점</td><td>64,000,000</td><td>560</td><td>20%</td></tr>
                                        <tr class="clickable-row" onclick="updateIndicator('off', '직영점', this)"><td class="pl-6 text-slate-500">└ 직영점</td><td>32,000,000</td><td>280</td><td>10%</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>컬러별 판매 현황</span><span id="off-t-color" class="badge bg-red-100 text-red-600">오프라인 전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table id="off-color-table"><thead><tr><th>컬러</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="off-color-body"></tbody></table></div>
                        </div>
                    </div>
                    <div class="lg:col-span-4">
                        <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                            <div class="section-title mb-4"><span>사이즈별 판매 현황</span><span id="off-t-size" class="badge bg-red-100 text-red-600">오프라인 전체</span></div>
                            <div class="table-container flex-1" style="height: calc(100% - 60px);"><table id="off-size-table"><thead><tr><th>사이즈</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="off-size-body"></tbody></table></div>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <span id="off-chart-title" class="text-sm font-black text-red-600">OFFLINE TREND ANALYSIS</span>
                        <div class="flex gap-2">
                            <div class="control-group">
                                <button id="off-sales" onclick="setChart('off', 'metric', 'sales')" class="btn-toggle btn-active">매출</button>
                                <button id="off-qty" onclick="setChart('off', 'metric', 'qty')" class="btn-toggle btn-inactive">수량</button>
                            </div>
                            <div class="control-group">
                                <button id="off-daily" onclick="setChart('off', 'view', 'daily')" class="btn-toggle btn-active">일</button>
                                <button id="off-weekly" onclick="setChart('off', 'view', 'weekly')" class="btn-toggle btn-inactive">주</button>
                                <button id="off-monthly" onclick="setChart('off', 'view', 'monthly')" class="btn-toggle btn-inactive">월</button>
                            </div>
                        </div>
                    </div>
                    <div style="height: 250px;"><canvas id="offChart"></canvas></div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-2xl border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>오프라인 매장 실적 TOP 15</span><span id="off-t-shop" class="badge bg-slate-100 text-slate-600">오프라인 전체</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);"><table class="w-full text-left"><thead><tr><th>순위</th><th>매장명</th><th>매출액</th><th>수량</th></tr></thead><tbody id="shop-rank-body"></tbody></table></div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>전국 지역별 매출 분포</span><span id="off-t-region" class="badge bg-slate-100 text-slate-600">오프라인 전체</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);"><table class="w-full text-left"><thead><tr><th>Region</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead><tbody id="region-rank-body"></tbody></table></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="group-2" class="pb-20">
            <div class="group-header">
                <h2 class="text-2xl font-black text-slate-900 tracking-tight">2. CUSTOMER ANALYSIS</h2>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mb-8">
                <div class="lg:col-span-4">
                    <div class="bg-white p-6 rounded-2xl shadow-md border-2 border-slate-300" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>회원 채널별 실적 (3-Depth)</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);">
                            <table>
                                <thead><tr><th>채널 구분</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead>
                                <tbody id="cust-list">
                                    <tr id="cust-total-row" class="clickable-row selected-customer" onclick="updateCustomerDetail('회원 전체', this)">
                                        <td class="font-bold">회원 전체</td><td>772,100,000</td><td>6,300</td><td>100%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('온라인', this)">
                                        <td class="pl-5 font-semibold text-blue-600">└ 온라인</td><td>452,100,000</td><td>3,500</td><td>58.5%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('자사몰', this)">
                                        <td class="pl-10 text-slate-500">└ 자사몰</td><td>452,100,000</td><td>3,500</td><td>100%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('오프라인', this)">
                                        <td class="pl-5 font-semibold text-red-600">└ 오프라인</td><td>320,000,000</td><td>2,800</td><td>41.5%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('백화점', this)">
                                        <td class="pl-10 text-slate-500">└ 백화점</td><td>224,000,000</td><td>1,960</td><td>70%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('대리점', this)">
                                        <td class="pl-10 text-slate-500">└ 대리점</td><td>64,000,000</td><td>560</td><td>20%</td>
                                    </tr>
                                    <tr class="clickable-row" onclick="updateCustomerDetail('직영점', this)">
                                        <td class="pl-10 text-slate-500">└ 직영점</td><td>32,000,000</td><td>280</td><td>10%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-4">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>컬러별 판매 현황</span><span id="cust-t-color" class="badge bg-purple-100 text-purple-600">회원 전체</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);"><table><thead><tr><th>컬러</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="cust-color-body"></tbody></table></div>
                    </div>
                </div>
                <div class="lg:col-span-4">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>사이즈별 판매 현황</span><span id="cust-t-size" class="badge bg-purple-100 text-purple-600">회원 전체</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);"><table><thead><tr><th>사이즈</th><th>판매수량</th><th>비중</th></tr></thead><tbody id="cust-size-body"></tbody></table></div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mt-8">
                <div class="lg:col-span-4">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="section-title mb-4"><span>기존/신규 회원</span><span id="cust-t-member" class="badge bg-purple-100 text-purple-600">회원 전체</span></div>
                        <div class="table-container flex-1" style="height: calc(100% - 60px);">
                            <table>
                                <thead><tr><th>회원 구분</th><th>매출액</th><th>수량</th><th>비중</th></tr></thead>
                                <tbody id="cust-member-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="lg:col-span-8">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200" style="height: 480px; display: flex; flex-direction: column;">
                        <div class="flex justify-between items-center mb-4">
                            <div class="section-title" style="margin: 0;">
                                <span>성별/연령대 분석</span>
                            </div>
                            <div class="control-group">
                                <button id="age-sales" onclick="setAgeChart('sales')" class="btn-toggle btn-active">매출액</button>
                                <button id="age-qty" onclick="setAgeChart('qty')" class="btn-toggle btn-inactive">판매량</button>
                            </div>
                        </div>
                        <div style="height: 350px; flex: 1;"><canvas id="ageChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATA 시뮬레이션 로직
        const DATA = {
            total: {
                '전체': { qty: 6300, sales: 772100000, colors: {BLACK: 3300, WHITE: 1400, GREY: 600, BEIGE: 600, NAVY: 400}, sizes: {'230': 400, '240': 900, '250': 2000, '260': 2000, '270': 1000} },
                '온라인': { qty: 3500, sales: 452100000, colors: {BLACK: 1500, WHITE: 1000, GREY: 600, NAVY: 400}, sizes: {'230': 400, '240': 900, '250': 1200, '260': 700, '270': 300} },
                '오프라인': { qty: 2800, sales: 320000000, colors: {BLACK: 1800, BEIGE: 600, WHITE: 400}, sizes: {'250': 800, '260': 1000, '270': 1000} }
            },
            on: {
                '온라인 전체': { qty: 3500, colors: {BLACK: 1500, WHITE: 1000, GREY: 600, NAVY: 400}, sizes: {'230': 400, '240': 900, '250': 1200, '260': 700, '270': 300} },
                '자사몰': { qty: 1050, colors: {BLACK: 450, WHITE: 350, GREY: 150, NAVY: 100}, sizes: {'230': 100, '240': 300, '250': 350, '260': 200, '270': 100} },
                '무신사': { qty: 875, colors: {BLACK: 400, WHITE: 200, GREY: 175, NAVY: 100}, sizes: {'240': 275, '250': 300, '260': 200, '270': 100} },
                '네이버 스토어': { qty: 700, colors: {BLACK: 300, WHITE: 250, GREY: 100, NAVY: 50}, sizes: {'230': 150, '240': 250, '250': 200, '260': 100} },
                '29CM': { qty: 525, colors: {BLACK: 200, WHITE: 150, GREY: 100, NAVY: 75}, sizes: {'230': 100, '240': 200, '250': 150, '260': 75} },
                'W컨셉': { qty: 350, colors: {BLACK: 150, WHITE: 50, GREY: 75, NAVY: 75}, sizes: {'230': 50, '240': 100, '250': 150, '260': 50} }
            },
            off: {
                '오프라인 전체': { qty: 2800, colors: {BLACK: 1800, BEIGE: 600, WHITE: 400}, sizes: {'250': 800, '260': 1000, '270': 1000}, geo: {서울: 1200, 경기: 800, 부산: 300, 대구: 200, 광주: 100, 대전: 100, 제주: 100} },
                '백화점': { qty: 1960, colors: {BLACK: 1300, BEIGE: 400, WHITE: 260}, sizes: {'250': 500, '260': 700, '270': 760}, geo: {서울: 1000, 경기: 500, 부산: 200, 대구: 100, 기타: 160} },
                '대리점': { qty: 560, colors: {BLACK: 300, BEIGE: 160, WHITE: 100}, sizes: {'250': 200, '260': 200, '270': 160}, geo: {서울: 100, 경기: 200, 부산: 100, 대구: 100, 광주: 60} },
                '직영점': { qty: 280, colors: {BLACK: 200, BEIGE: 40, WHITE: 40}, sizes: {'250': 100, '260': 100, '270': 80}, geo: {서울: 100, 경기: 100, 부산: 80} }
            },
            cust: {
                '회원 전체': { qty: 6300, sales: 772100000, colors: {BLACK: 3000, WHITE: 2000, GREY: 1300}, sizes: {'240': 1500, '250': 2500, '260': 2300}, members: {기존회원: {qty: 4410, sales: 540470000}, 신규회원: {qty: 1890, sales: 231630000}}, ageGender: {male: {'15-19': {qty: 180, sales: 22000000}, '20-24': {qty: 520, sales: 64000000}, '25-29': {qty: 850, sales: 104000000}, '30-34': {qty: 920, sales: 112000000}, '35-39': {qty: 680, sales: 83000000}, '40-44': {qty: 450, sales: 55000000}, '45-49': {qty: 320, sales: 39000000}, '50-54': {qty: 220, sales: 27000000}, '55-59': {qty: 150, sales: 18000000}, '60~': {qty: 120, sales: 15000000}}, female: {'15-19': {qty: 200, sales: 24000000}, '20-24': {qty: 680, sales: 83000000}, '25-29': {qty: 950, sales: 116000000}, '30-34': {qty: 780, sales: 95000000}, '35-39': {qty: 520, sales: 64000000}, '40-44': {qty: 380, sales: 46000000}, '45-49': {qty: 280, sales: 34000000}, '50-54': {qty: 200, sales: 24000000}, '55-59': {qty: 130, sales: 16000000}, '60~': {qty: 100, sales: 12000000}}} },
                '온라인': { qty: 3500, sales: 452100000, colors: {BLACK: 1500, WHITE: 1200, GREY: 800}, sizes: {'240': 1000, '250': 1500, '260': 1000}, members: {기존회원: {qty: 2450, sales: 316470000}, 신규회원: {qty: 1050, sales: 135630000}}, ageGender: {male: {'15-19': {qty: 100, sales: 12000000}, '20-24': {qty: 290, sales: 36000000}, '25-29': {qty: 470, sales: 58000000}, '30-34': {qty: 510, sales: 62000000}, '35-39': {qty: 380, sales: 46000000}, '40-44': {qty: 250, sales: 30000000}, '45-49': {qty: 180, sales: 22000000}, '50-54': {qty: 120, sales: 15000000}, '55-59': {qty: 80, sales: 10000000}, '60~': {qty: 70, sales: 8000000}}, female: {'15-19': {qty: 110, sales: 13000000}, '20-24': {qty: 380, sales: 46000000}, '25-29': {qty: 530, sales: 65000000}, '30-34': {qty: 430, sales: 52000000}, '35-39': {qty: 290, sales: 35000000}, '40-44': {qty: 210, sales: 25000000}, '45-49': {qty: 150, sales: 18000000}, '50-54': {qty: 110, sales: 13000000}, '55-59': {qty: 70, sales: 8000000}, '60~': {qty: 60, sales: 7000000}}} },
                '자사몰': { qty: 3500, sales: 452100000, colors: {BLACK: 1500, WHITE: 1200, GREY: 800}, sizes: {'240': 1000, '250': 1500, '260': 1000}, members: {기존회원: {qty: 2450, sales: 316470000}, 신규회원: {qty: 1050, sales: 135630000}}, ageGender: {male: {'15-19': {qty: 100, sales: 12000000}, '20-24': {qty: 290, sales: 36000000}, '25-29': {qty: 470, sales: 58000000}, '30-34': {qty: 510, sales: 62000000}, '35-39': {qty: 380, sales: 46000000}, '40-44': {qty: 250, sales: 30000000}, '45-49': {qty: 180, sales: 22000000}, '50-54': {qty: 120, sales: 15000000}, '55-59': {qty: 80, sales: 10000000}, '60~': {qty: 70, sales: 8000000}}, female: {'15-19': {qty: 110, sales: 13000000}, '20-24': {qty: 380, sales: 46000000}, '25-29': {qty: 530, sales: 65000000}, '30-34': {qty: 430, sales: 52000000}, '35-39': {qty: 290, sales: 35000000}, '40-44': {qty: 210, sales: 25000000}, '45-49': {qty: 150, sales: 18000000}, '50-54': {qty: 110, sales: 13000000}, '55-59': {qty: 70, sales: 8000000}, '60~': {qty: 60, sales: 7000000}}} },
                '오프라인': { qty: 2800, sales: 320000000, colors: {BLACK: 1500, BEIGE: 800, WHITE: 500}, sizes: {'250': 1000, '260': 1300, '270': 500}, members: {기존회원: {qty: 1960, sales: 224000000}, 신규회원: {qty: 840, sales: 96000000}}, ageGender: {male: {'15-19': {qty: 80, sales: 10000000}, '20-24': {qty: 230, sales: 28000000}, '25-29': {qty: 380, sales: 46000000}, '30-34': {qty: 410, sales: 50000000}, '35-39': {qty: 300, sales: 37000000}, '40-44': {qty: 200, sales: 25000000}, '45-49': {qty: 140, sales: 17000000}, '50-54': {qty: 100, sales: 12000000}, '55-59': {qty: 70, sales: 8000000}, '60~': {qty: 50, sales: 6000000}}, female: {'15-19': {qty: 90, sales: 11000000}, '20-24': {qty: 300, sales: 37000000}, '25-29': {qty: 420, sales: 51000000}, '30-34': {qty: 350, sales: 43000000}, '35-39': {qty: 230, sales: 29000000}, '40-44': {qty: 170, sales: 21000000}, '45-49': {qty: 130, sales: 16000000}, '50-54': {qty: 90, sales: 11000000}, '55-59': {qty: 60, sales: 8000000}, '60~': {qty: 40, sales: 5000000}}} },
                '백화점': { qty: 1960, sales: 224000000, colors: {BLACK: 1000, BEIGE: 600, WHITE: 360}, sizes: {'250': 700, '260': 900, '270': 360}, members: {기존회원: {qty: 1372, sales: 156800000}, 신규회원: {qty: 588, sales: 67200000}}, ageGender: {male: {'15-19': {qty: 56, sales: 7000000}, '20-24': {qty: 161, sales: 19600000}, '25-29': {qty: 266, sales: 32200000}, '30-34': {qty: 287, sales: 35000000}, '35-39': {qty: 210, sales: 25900000}, '40-44': {qty: 140, sales: 17500000}, '45-49': {qty: 98, sales: 11900000}, '50-54': {qty: 70, sales: 8400000}, '55-59': {qty: 49, sales: 5600000}, '60~': {qty: 35, sales: 4200000}}, female: {'15-19': {qty: 63, sales: 7700000}, '20-24': {qty: 210, sales: 25900000}, '25-29': {qty: 294, sales: 35700000}, '30-34': {qty: 245, sales: 30100000}, '35-39': {qty: 161, sales: 24500000}, '40-44': {qty: 119, sales: 17500000}, '45-49': {qty: 91, sales: 11200000}, '50-54': {qty: 63, sales: 9100000}, '55-59': {qty: 42, sales: 5600000}, '60~': {qty: 28, sales: 3500000}}} },
                '대리점': { qty: 560, sales: 64000000, colors: {BLACK: 300, BEIGE: 150, WHITE: 110}, sizes: {'250': 200, '260': 260, '270': 100}, members: {기존회원: {qty: 392, sales: 44800000}, 신규회원: {qty: 168, sales: 19200000}}, ageGender: {male: {'15-19': {qty: 16, sales: 2000000}, '20-24': {qty: 46, sales: 5600000}, '25-29': {qty: 76, sales: 9200000}, '30-34': {qty: 82, sales: 10000000}, '35-39': {qty: 60, sales: 7400000}, '40-44': {qty: 40, sales: 5000000}, '45-49': {qty: 28, sales: 3400000}, '50-54': {qty: 20, sales: 2400000}, '55-59': {qty: 14, sales: 1600000}, '60~': {qty: 10, sales: 1200000}}, female: {'15-19': {qty: 18, sales: 2200000}, '20-24': {qty: 60, sales: 7400000}, '25-29': {qty: 84, sales: 10200000}, '30-34': {qty: 70, sales: 8600000}, '35-39': {qty: 46, sales: 7000000}, '40-44': {qty: 34, sales: 5000000}, '45-49': {qty: 26, sales: 3200000}, '50-54': {qty: 18, sales: 2200000}, '55-59': {qty: 12, sales: 1600000}, '60~': {qty: 8, sales: 1000000}}} },
                '직영점': { qty: 280, sales: 32000000, colors: {BLACK: 200, BEIGE: 50, WHITE: 30}, sizes: {'250': 100, '260': 140, '270': 40}, members: {기존회원: {qty: 196, sales: 22400000}, 신규회원: {qty: 84, sales: 9600000}}, ageGender: {male: {'15-19': {qty: 8, sales: 1000000}, '20-24': {qty: 23, sales: 2800000}, '25-29': {qty: 38, sales: 4600000}, '30-34': {qty: 41, sales: 5000000}, '35-39': {qty: 30, sales: 3700000}, '40-44': {qty: 20, sales: 2500000}, '45-49': {qty: 14, sales: 1700000}, '50-54': {qty: 10, sales: 1200000}, '55-59': {qty: 7, sales: 800000}, '60~': {qty: 5, sales: 600000}}, female: {'15-19': {qty: 9, sales: 1100000}, '20-24': {qty: 30, sales: 3700000}, '25-29': {qty: 42, sales: 5100000}, '30-34': {qty: 35, sales: 4300000}, '35-39': {qty: 23, sales: 2900000}, '40-44': {qty: 17, sales: 2100000}, '45-49': {qty: 13, sales: 1600000}, '50-54': {qty: 9, sales: 1100000}, '55-59': {qty: 6, sales: 800000}, '60~': {qty: 4, sales: 500000}}} }
            }
        };

        const states = {
            main: { metric: 'sales', view: 'daily', chart: null, selectedChannel: '전체' },
            on: { metric: 'sales', view: 'daily', chart: null, selectedChannel: '온라인 전체' },
            off: { metric: 'sales', view: 'daily', chart: null, selectedChannel: '오프라인 전체' },
            age: { metric: 'sales', chart: null, selectedChannel: '회원 전체' }
        };

        $(document).ready(function() {
            $('.js-example-basic-multiple').select2({ placeholder: "선택하세요" });
            fetchAll();
            updateCustomerDetail('회원 전체', $('#cust-total-row')[0]);
            updateTotalDetail('전체', $('#total-total-row')[0]);
        });

        function setChart(key, type, val) {
            states[key][type] = val;
            $(`[id^="${key}-${type === 'metric' ? 'sales' : 'daily'}"]`).parent().find('button').removeClass('btn-active').addClass('btn-inactive');
            $(`#${key}-${val}`).addClass('btn-active').removeClass('btn-inactive');
            renderSingleChart(key);
        }

        function updateIndicator(type, name, rowElement) {
            const container = document.getElementById(`${type}-list`);
            Array.from(container.querySelectorAll('tr')).forEach(r => r.classList.remove(type === 'on' ? 'selected-online' : 'selected-offline'));
            if(rowElement) rowElement.classList.add(type === 'on' ? 'selected-online' : 'selected-offline');

            document.getElementById(`${type}-t-color`).innerText = name;
            document.getElementById(`${type}-t-size`).innerText = name;
            
            const d = DATA[type][name] || DATA[type][type === 'on' ? '온라인 전체' : '오프라인 전체'];
            fillTable(`${type}-color-body`, d.colors, d.qty);
            fillTable(`${type}-size-body`, d.sizes, d.qty);
            
            states[type].selectedChannel = name;
            document.getElementById(`${type}-chart-title`).innerText = `${type.toUpperCase()} TREND: ${name}`;
            renderSingleChart(type);

            if(type === 'off') {
                document.getElementById('off-t-region').innerText = name;
                document.getElementById('off-t-shop').innerText = name;
                updateShopRank(name);
                updateRegionTable(d.geo, d.qty);
            }
        }

        function updateTotalDetail(name, rowElement) {
            $('#total-list tr').removeClass('selected-total');
            $(rowElement).addClass('selected-total');
            $('#total-t-color').text(name);
            $('#total-t-size').text(name);
            
            const d = DATA.total[name] || DATA.total['전체'];
            fillTable('total-color-body', d.colors, d.qty);
            fillTable('total-size-body', d.sizes, d.qty);
            
            // 통합 매출 그래프 업데이트
            states.main.selectedChannel = name;
            document.getElementById('main-chart-title').innerText = `TOTAL TREND: ${name}`;
            renderSingleChart('main');
        }

        function updateCustomerDetail(name, rowElement) {
            $('#cust-list tr').removeClass('selected-customer');
            $(rowElement).addClass('selected-customer');
            $('#cust-t-color').text(name);
            $('#cust-t-size').text(name);
            
            // 회원 구분 배지 업데이트 (제목은 "기존/신규 회원"으로 고정)
            let displayName = name;
            if (!name.includes('전체') && name !== '자사몰') {
                displayName = name + ' 전체';
            }
            $('#cust-t-member').text(displayName);
            
            const d = DATA.cust[name];
            fillTable('cust-color-body', d.colors, d.qty);
            fillTable('cust-size-body', d.sizes, d.qty);
            fillMemberTable('cust-member-body', d.members, d.qty, d.sales, name);
            
            // 연령대 그래프 업데이트
            states.age.selectedChannel = name;
            renderAgeChart();
        }

        function fillMemberTable(id, members, totalQty, totalSales, channelName) {
            const b = document.getElementById(id);
            b.innerHTML = '';
            
            // SUM 행 추가 (선택한 채널명 표시)
            b.innerHTML += `<tr class="font-black bg-purple-50">
                <td>${channelName}</td>
                <td>${totalSales.toLocaleString()}</td>
                <td>${totalQty.toLocaleString()}</td>
                <td class="text-purple-600">100.0%</td>
            </tr>`;
            
            // 기존회원, 신규회원 행 추가
            Object.entries(members).forEach(([memberType, data]) => {
                const qtyRatio = ((data.qty / totalQty) * 100).toFixed(1);
                b.innerHTML += `<tr>
                    <td class="font-bold">${memberType}</td>
                    <td>${data.sales.toLocaleString()}</td>
                    <td>${data.qty.toLocaleString()}</td>
                    <td class="text-slate-400">${qtyRatio}%</td>
                </tr>`;
            });
        }

        function fillTable(id, obj, total) {
            const b = document.getElementById(id); b.innerHTML = '';
            Object.entries(obj).forEach(([k, v]) => {
                b.innerHTML += `<tr><td>${k}</td><td class="font-bold">${v.toLocaleString()}</td><td class="text-slate-400">${((v/total)*100).toFixed(1)}%</td></tr>`;
            });
        }

        function updateShopRank(channel) {
            const body = document.getElementById('shop-rank-body'); body.innerHTML = '';
            const isTotal = channel.includes('전체');
            for(let i=1; i<=15; i++) {
                const sales = Math.floor(Math.random() * 5000000) + 2000000;
                body.innerHTML += `<tr><td class="font-black text-slate-300">${i}</td><td class="font-semibold text-slate-700">${isTotal ? '베스트' : channel} 매장 ${i}호점</td><td>${sales.toLocaleString()}원</td><td>${Math.floor(sales/80000)}</td></tr>`;
            }
        }

        function updateRegionTable(geoData, totalQty) {
            const body = document.getElementById('region-rank-body'); body.innerHTML = '';
            Object.entries(geoData).forEach(([region, qty]) => {
                const sales = qty * 75000;
                body.innerHTML += `<tr><td class="font-bold">${region}</td><td>${sales.toLocaleString()}원</td><td>${qty.toLocaleString()}</td><td class="text-blue-600 font-black">${((qty/totalQty)*100).toFixed(1)}%</td></tr>`;
            });
        }

        function renderSingleChart(key) {
            const canvasEl = document.getElementById(`${key}Chart`);
            if(!canvasEl) return;
            const s = states[key];
            if (s.chart) s.chart.destroy();

            let labels = ['01-12', '01-13', '01-14', '01-15', '01-16'];
            if(s.view === 'weekly') labels = ['Jan W1', 'Jan W2', 'Jan W3', 'Jan W4'];
            if(s.view === 'monthly') labels = ['Oct', 'Nov', 'Dec', 'Jan'];

            let ds = [];
            const multiplier = s.view === 'daily' ? 1 : (s.view === 'weekly' ? 5.5 : 22);

            if(key === 'main') {
                const channel = s.selectedChannel || '전체';
                if(channel === '전체') {
                    ds = [
                        { label: 'ONLINE TOTAL', data: [320, 450, 380, 520, 480].map(v => (s.metric === 'sales' ? v*60000 : v)*multiplier), borderColor: '#2563eb', tension: 0.4, borderWidth: 2, pointRadius: 2 },
                        { label: 'OFFLINE TOTAL', data: [280, 310, 290, 410, 390].map(v => (s.metric === 'sales' ? v*70000 : v)*multiplier), borderColor: '#dc2626', tension: 0.4, borderWidth: 2, pointRadius: 2 }
                    ];
                } else if(channel === '온라인') {
                    ds = [
                        { label: 'ONLINE TOTAL', data: [320, 450, 380, 520, 480].map(v => (s.metric === 'sales' ? v*60000 : v)*multiplier), borderColor: '#2563eb', tension: 0.4, borderWidth: 2, pointRadius: 2 }
                    ];
                } else if(channel === '오프라인') {
                    ds = [
                        { label: 'OFFLINE TOTAL', data: [280, 310, 290, 410, 390].map(v => (s.metric === 'sales' ? v*70000 : v)*multiplier), borderColor: '#dc2626', tension: 0.4, borderWidth: 2, pointRadius: 2 }
                    ];
                }
            } else {
                const isOn = key === 'on';
                const targets = s.selectedChannel.includes('전체') ? (isOn ? ['자사몰','무신사','네이버'] : ['백화점','대리점','직영점']) : [s.selectedChannel];
                const colors = isOn ? ['#3b82f6', '#10b981', '#f59e0b'] : ['#ef4444', '#f97316', '#6366f1'];
                
                ds = targets.map((name, i) => ({
                    label: name,
                    data: [100, 150, 130, 180, 160].map(v => (s.metric === 'sales' ? v*55000 : v)*multiplier*(0.8 + Math.random()*0.4)),
                    borderColor: colors[i % colors.length],
                    tension: 0.4,
                    borderWidth: 2,
                    pointRadius: 2
                }));
            }

            s.chart = new Chart(canvasEl.getContext('2d'), {
                type: 'line',
                data: { labels, datasets: ds },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'bottom', labels: { boxWidth: 12, font: { weight: 'bold', size: 10 } } } },
                    scales: { 
                        y: { beginAtZero: true, grid: { color: '#f1f5f9' }, ticks: { font: { size: 10 } } },
                        x: { grid: { display: false }, ticks: { font: { size: 10 } } }
                    }
                }
            });
        }

        function setAgeChart(metric) {
            states.age.metric = metric;
            $('#age-sales, #age-qty').removeClass('btn-active').addClass('btn-inactive');
            $(`#age-${metric}`).addClass('btn-active').removeClass('btn-inactive');
            renderAgeChart();
        }

        function renderAgeChart() {
            const canvasEl = document.getElementById('ageChart');
            if(!canvasEl) return;
            const s = states.age;
            if (s.chart) s.chart.destroy();

            const ageLabels = ['15-19', '20-24', '25-29', '30-34', '35-39', '40-44', '45-49', '50-54', '55-59', '60~'];
            const channelName = s.selectedChannel || '회원 전체';
            const d = DATA.cust[channelName];
            
            if (!d || !d.ageGender) return;

            const maleData = ageLabels.map(age => {
                const data = d.ageGender.male[age] || {qty: 0, sales: 0};
                return s.metric === 'sales' ? data.sales : data.qty;
            });

            const femaleData = ageLabels.map(age => {
                const data = d.ageGender.female[age] || {qty: 0, sales: 0};
                return s.metric === 'sales' ? data.sales : data.qty;
            });

            s.chart = new Chart(canvasEl.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: ageLabels,
                    datasets: [
                        {
                            label: '남성',
                            data: maleData,
                            backgroundColor: 'rgba(59, 130, 246, 0.7)',
                            borderColor: '#3b82f6',
                            borderWidth: 2
                        },
                        {
                            label: '여성',
                            data: femaleData,
                            backgroundColor: 'rgba(236, 72, 153, 0.7)',
                            borderColor: '#ec4899',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom', labels: { boxWidth: 12, font: { weight: 'bold', size: 10 } } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed.y;
                                    return context.dataset.label + ': ' + (s.metric === 'sales' ? value.toLocaleString() + '원' : value.toLocaleString());
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' },
                            ticks: {
                                font: { size: 10 },
                                callback: function(value) {
                                    return s.metric === 'sales' ? (value / 1000000).toFixed(0) + 'M' : value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { font: { size: 10 } }
                        }
                    }
                }
            });
        }

        function fetchAll() { 
            renderSingleChart('main'); renderSingleChart('on'); renderSingleChart('off'); 
            updateIndicator('on', states.on.selectedChannel, null);
            updateIndicator('off', states.off.selectedChannel, null);
            renderAgeChart();
            document.getElementById('main-chart-title').innerText = `TOTAL TREND: ${states.main.selectedChannel || '전체'}`;
        }
    </script>
</body>
</html>