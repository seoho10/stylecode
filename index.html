<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Stylecode Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
      background: #f6f7fb;
    }

    h1 {
      margin-bottom: 20px;
    }

    .control-box {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .control-box input {
      padding: 8px;
      margin-right: 10px;
    }

    button {
      padding: 8px 14px;
      cursor: pointer;
    }

    .kpi-box {
      background: white;
      padding: 25px;
      border-radius: 12px;
      width: 300px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    .kpi-title {
      color: #666;
      font-size: 14px;
    }

    .kpi-value {
      font-size: 28px;
      font-weight: bold;
      margin-top: 10px;
    }

    .update-time {
      font-size: 12px;
      color: #888;
      margin-top: 8px;
    }
  </style>
</head>

<body>

  <h1>Stylecode Sales Dashboard</h1>

  <div class="control-box">
    Brand :
    <input id="brand" value="A" />

    Month (YYYY-MM) :
    <input id="month" value="2025-12" />

    <button onclick="loadData()">조회</button>
  </div>

  <div class="kpi-box">
    <div class="kpi-title">월 매출</div>
    <div id="sales" class="kpi-value">Loading...</div>
    <div id="time" class="update-time"></div>
  </div>

<script>
  // ✅ Streamlit API 주소 (seoho님 주소 고정 적용)
  const API_URL = "https://stylecode-api-dpqrqczbz89gpmn2hnxx34.streamlit.app/";

  async function loadData() {

    const brand = document.getElementById("brand").value.trim();
    const month = document.getElementById("month").value.trim();

    const url = `${API_URL}?brand=${encodeURIComponent(brand)}&month=${encodeURIComponent(month)}`;

    try {
      const res = await fetch(url);
      const html = await res.text();

      // Streamlit 페이지 안에 JSON이 섞여 있으므로
      // JSON 부분만 파싱
      const jsonStart = html.indexOf("{");
      const jsonEnd = html.lastIndexOf("}") + 1;

      const jsonText = html.substring(jsonStart, jsonEnd);
      const data = JSON.parse(jsonText);

      // 화면 표시
      const sales = Number(data.sales_amt).toLocaleString();

      document.getElementById("sales").innerText = `${sales} 원`;
      document.getElementById("time").innerText = `Updated: ${data.generated_at}`;

    } catch (err) {
      document.getElementById("sales").innerText = "Error";
      document.getElementById("time").innerText = err.message;
      console.error(err);
    }
  }

  // 최초 자동 실행
  loadData();

</script>

</body>
</html>
